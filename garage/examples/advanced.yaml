# Advanced configuration with multi-node layout, monitoring, resource tuning, and Gateway API routes

deployment:
  replicaCount: 3

garage:
  replicationFactor: "2"
  secret:
    rpcSecret: "4425f5c26c5e11581d3223904324dcb5b5d5dfb14e5e7f35e38c595424f5f1e6" # openssl rand -hex 32
    adminToken: "UkLeGWEvHnXBqnueR3ISEMWpOnm40jH2tM2HnnL/0F4=" # openssl rand -base64 32
  s3:
    api:
      rootDomain: ".s3.prod.example.com"
    web:
      rootDomain: ".web.prod.example.com"

persistence:
  enabled: true
  data:
    storageClass: garage-perf-hdd
    size: 5Ti
  meta:
    storageClass: longhorn
    size: 512Mi

resources:
  requests:
    cpu: 1000m
    memory: 4Gi
  limits:
    cpu: 2000m
    memory: 8Gi

clusterConfig:
  enabled: true
  layout:
    enabled: true
    zone: dc-west
    capacity: 5Ti
  buckets:
    - name: analytics
    - name: media
      public: true
    - name: compliance
  keys:
    # Example of multiple keys with different bucket access within values.yaml
    analytics-media-key:
      keyId: GKFEDCBA9876543210FEDCBA98
      secretKey: 89abcdef0123456789abcdef0123456789abcdef0123456789abcdef01234567
      buckets:
        - analytics
        - media
    compliance-key:
      keyId: GK00112233445566778899AABB
      secretKey: 76543210fedcba9876543210fedcba9876543210fedcba9876543210fedcba98
      buckets:
        - compliance
    # Example using a secret created via extraResources
    external-key:
      secretName: my-external-key
      keyId: keyId
      secretKey: secretKey
      buckets:
        - analytics
  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

monitoring:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      interval: 30s
      labels:
        release: monitoring
  grafanaDashboard:
    enabled: true
  tracing:
    sink: http://tempo.monitoring.svc.cluster.local:4317

gatewayApi:
  s3:
    api:
      enabled: true
      hostnames:
        - s3.garage.prod.example.com
      parentRefs:
        - name: shared-gateway
          namespace: networking
          sectionName: https
    web:
      enabled: true
      hostnames:
        - web.garage.prod.example.com
      parentRefs:
        - name: shared-gateway
          namespace: networking
          sectionName: https

webui:
  enabled: true

  auth:
    enabled: true
    userPassHash: "admin:$2y$10$wjnUPtyPiODuT7f1t5rs5O.HYYpM0EeP0D7EXoeHKfBwPX7rUSaTG" # htpasswd -nbBC 10 "admin" "admin1234"

  gatewayApi:
    enabled: true
    hostnames:
      - ui.garage.prod.example.com
    parentRefs:
      - name: shared-gateway
        namespace: networking
        sectionName: https

# Example of creating a secret to be used in clusterConfig.keys
extraResources:
  - apiVersion: v1
    kind: Secret
    metadata:
      name: my-external-key
    stringData:
      keyId: GK12345678901234567890abcd
      secretKey: 123456789012345678901234567890123456789012345678901234567890abcd
